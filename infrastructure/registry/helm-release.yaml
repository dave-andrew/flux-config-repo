apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: kubernetes-registry
  namespace: registry
spec:
  interval: 30m
  chart:
    spec:
      chart: docker-registry
      version: "*"
      sourceRef:
        kind: HelmRepository
        name: kubernetes-registry-repository
  upgrade:
    remediation:
      remediateLastFailure: true
  values:
    replicaCount: 3
    persistence:
      enabled: true
      size: 10Gi
      deleteEnabled: true
      storageClass: nfs-csi
      existingClaim: docker-registry-pv-claim
      accessMode: 'ReadWriteOnce'
    garbageCollect:
      enabled: true
      deleteUntagged: true
      schedule: "0 1 * * *"
      resources: {}

